<!-- By + Copyright Greg Abbott 2025. V 2025_0326 -->
<html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="icon" href="data:;base64,iVBORw0KGgo="><style>/* c.css */
:root {color-scheme: light dark;--light:hsl(60, 25%, 95%);--dark:hsl(15, 5%, 10%);--accent:light-dark(#f50,#7d3);--bg:light-dark(var(--light),var(--dark));--fg:light-dark(var(--dark),var(--light));--base_size:15px;--half_base_size:calc(var(--base_size)/2);--twice_base_size:calc(var(--base_size)*2);--border: 2px solid var(--fg);--check:var(--dark);--checkerboard: repeating-linear-gradient(0deg,var(--check) 0px, var(--check) 1px, transparent 1px, transparent 2px),repeating-linear-gradient(90deg,var(--check) 0px, var(--check) 1px, transparent 1px, transparent 2px);}* {border: none;outline:none;box-sizing: border-box;margin: 0;padding: 0;font-family: system-ui;font-size: var(--base_size);line-height: 100%;color: var(--fg);background-color: var(--bg);line-height: 1.1em;}html,body {height: 100dvh;min-height: 100dvh;max-height: 100dvh;width: 100dvw;max-width: 100dvw;min-width: 100dvw;}@media (prefers-color-scheme: dark) {::-moz-selection {background: var(--light);color: var(--dark);}::selection {background: var(--light);color: var(--dark);}}@media (prefers-color-scheme: light) {::-moz-selection {background: var(--dark);color: var(--light);}::selection {background: var(--dark);color: var(--light);}}.no_select,.toolbar,.button{user-select: none;-webkit-user-select: none;-moz-user-select: none;-ms-user-select: none;cursor: default;}hr {width: 100%;border: none;height: 1px;margin: 0;background-color: var(--fg);}input:checked ~ label {background-color:var(--fg);color: var(--bg);}#current_file_name{cursor: pointer;border-bottom: var(--border);}footer {display: flex;flex-direction: row;justify-content: right;padding: 1ch 0;gap: 1ch;align-items: center;margin: auto;flex-grow: 1;}footer,footer *{font-size: xx-small;}footer button {padding: 0 3px;border-radius: 5px;border: 1px solid transparent;}footer button:hover {border-color: var(--fg);}body {justify-content: center;font-family: sans-serif;margin: 0;text-align: center;position: relative;display: flex;flex-direction: column;overflow: hidden;}canvas.drag {outline: 2px solid var(--fg);background: var(--bg);}.toolbar {width: 100%;display: flex;flex-wrap: wrap;gap: 1ch;flex-shrink: none;height: auto;align-items: center;padding: 0 1ch;}[popover]{left: 50%;top: 50%;transform: translate(-50%, -50%);border-radius: 10px;text-align: left;padding: 1ch;width: 64ch;border: var(--border);border-width: 2px;max-width: 90dvw;}#loupe{outline: 2px solid var(--bg);width: 100px;height:100px;z-index: 9999;border-radius: 100px;position: fixed;bottom: 0;left: 0;align-items: center;background: transparent;cursor: no-drop;border: 43px solid var(--fg);transform: translate(-50%, -50%);pointer-events:none;}main {display: flex;max-height: 100%;flex-grow: 1;flex-shrink: 1;justify-content: center;overflow: hidden;padding:2ch 0ch;background-color: var(--bg);}p {margin-bottom: 1em;}main>div {justify-content: center;background-color: var(--bg);width: 50%;position: relative;display: flex;flex-direction: column;flex-shrink: 1;flex-grow: 0;padding: 1ch;}button {border: none;font-weight: bold;background: transparent;}.button {background-color: var(--bg);margin: 0;font-size: 1em;border: var(--border);padding: 3px 2ch;cursor: pointer;border-radius: 100px;}.button:active{background-color: var(--fg);color: var(--bg) !important;}.left .canvas_holder:hover #current_file_name,.right .canvas_holder:hover #save_quantized_image {display: block;}#save_quantized_image,#current_file_name {display: none;position: absolute;top: 2ch;left: 50%;transform: translate(-50%);max-width: calc(100% - 4ch);white-space: nowrap;overflow: hidden;text-overflow: ellipsis;color: var(--fg);}.canvas_holder {flex-direction: column;flex-grow: 0;max-height: 100%;width: 100%;flex-shrink: 1;position: relative;justify-content: center;align-items: center;padding: 1ch;display: flex;}.left canvas {cursor: none;}canvas {width: 100%;background: var(--fg);border-radius: 10px;max-width: 100%;max-height: 100%;}.swatch_bar {display: flex;flex-direction: row;}#swatches_holder {border-radius: 1em;overflow: hidden;display: flex;flex-wrap: wrap;gap: 0;border: var(--border);min-width: 1em;}body:has(:popover-open) {#hide_popover {display: block;}}#hide_popover {display: none;z-index: 3;background: var(--checkerboard);background-size: 2px;background-position: 0 0;width: 100dvw;height: 100dvh;position: fixed;top: 0;left: 0;}.swatch {aspect-ratio: 1/1;height: calc(1.1em + 6px);cursor: pointer;border: 0px solid var(--fg);position: relative;}.delete_selected_swatch {cursor: pointer;}.hide {display: none !important;}.swatch.active::after {background: var(--bg);border: var(--border);content: ' ';top: 50%;left: 50%;border-radius: 100px;position: absolute;transform: translate(-50%,-50%);display: block;width: 30%;height: 30%;}</style><title>
Swotch - Make limited palette PNGs and SVG swatches from images
</title></head><body><div id="hide_popover"></div><div popover="" id="po_about"><p>This tool can produce:<br>
- A limited colour version of an image.<br>
- An SVG swatch palette from picked colours in an image.</p><p>How to use it:<br>
- Load an image (Drag and drop).<br>
- Click colours in the image to keep.<br>
- Save the limited palette image and or colour swatches.</p><p>By and Copyright © 2025 <a href="https://gregabbott.pages.dev">Greg Abbott</a>.<br>
All rights reserved.<br>
(Site, tool, documentation etc.)</p><p>NO WARRANTY<br>
THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
</p></div><main><div class="left"><div class="canvas_holder"><div id="current_file_name" class="no_select button" title="Click to load an image, or drag-and-drop">Load image</div><canvas id="original_canvas"></canvas><div id="loupe" class="hide"></div></div><div class="toolbar no_select"><input type="file" id="file_picker" hidden="" accept="image/*"><input type="checkbox" id="toggle_greyscale" hidden=""><label for="toggle_greyscale" class="button" title="Click to toggle between the image and a greyscale version of it">Grey</label><footer><button popovertarget="po_about">© 2025</button><a href="https://gregabbott.pages.dev/">Greg Abbott</a></footer></div></div><div class="right"><div class="canvas_holder" title="This area will show a limited palette version of the image on the left,
using only the colours you select from it."><div id="save_quantized_image" class="button" title="Save this Quantized (Limited Palette) Image (PNG)">Save</div><canvas id="output_canvas"></canvas></div><div class="toolbar"><div id="save_swatches" class="button" title="Save the SVG Swatch Palette">Save</div><div id="swatches_holder" class="hide" title="Click a swatch to select it, then change or delete it"></div><div id="delete_selected_swatch" class="hide button" title="Delete the currently selected Swatch">Delete</div></div></div></main><script>/* j.js */
const e=["current_file_name","loupe","save_quantized_image","save_swatches","file_picker","toggle_greyscale","original_canvas","output_canvas","swatches_holder"].reduce(((e,t)=>(e[t]=document.getElementById(t),e)),{}),t=e.original_canvas.getContext("2d",{willReadFrequently:!0}),a=e.output_canvas.getContext("2d");let n=[],i=null,l=null,o=null;const c=document.getElementById("delete_selected_swatch");let r=null;function s(t){let a=[...t.files];if(0==a.length)return;let i=a.reduce(((e,t)=>{let a={handle:t,ext:t.name.split(".").pop(),date:t.lastModified,type:t.type};return e.push(a),e}),[]),c=[],s=new Set;!function t({i:a,files:i}){const d=i[a],u=new FileReader;u.onload=()=>{var f;d.data=u.result,d.name=function(e){let t=e;var a=0;for(;s.has(t);)t=e+" "+ ++a;return t}((f=d.handle.name).substring(0,f.lastIndexOf("."))),s.add(d.name),c.push(d),a==i.length-1?function(t){if(0==t.length)return;let a=t[0];!function(t){if(!t)return;e.current_file_name.innerText=t.name,r=t,n=[],m();const a=new Image;a.onload=()=>{e.original_canvas.width=e.output_canvas.width=a.width,e.original_canvas.height=e.output_canvas.height=a.height;let t=a.naturalWidth/a.naturalHeight;e.original_canvas.style.aspectRatio=t,e.output_canvas.style.aspectRatio=t,r.aspect_ratio=t,window.onresize=h,h(),function(e,t){let a=t.getContext("2d");t.width=e.width,t.height=e.height,a.drawImage(e,0,0),o=a.getImageData(0,0,t.width,t.height);let n=new Uint8ClampedArray(o.data);for(let e=0;e<n.length;e+=4){let t=.3*n[e]+.59*n[e+1]+.11*n[e+2];n[e]=n[e+1]=n[e+2]=t}l=new ImageData(n,t.width,t.height)}(a,e.original_canvas),g()},a.src=t.data}(a)}(c):t({i:a+1,files:i})},u.readAsDataURL(d.handle)}({i:0,files:i})}e.current_file_name.onclick=()=>e.file_picker.click(),e.toggle_greyscale.onchange=()=>g(),e.original_canvas.onclick=t=>{r?function(){null!==i?(n[i]=e.loupe.color,i=null,f(c)):n.push(e.loupe.color);m(),_()}():e.file_picker.click()},e.save_quantized_image.onclick=function(){const t=document.createElement("a");t.download=r.name+" quantized.png",t.href=e.output_canvas.toDataURL(),t.click()},function(t){function a(e){return t=>window.addEventListener(t,e,!1)}function n(){t.classList.remove("drag")}["dragenter","dragover","dragleave","drop"].forEach(a((function(e){e.stopPropagation(),e.preventDefault()}))),["dragenter","dragover"].forEach(a((function(){t.classList.add("drag")}))),a(n)("dragleave"),a((function(t){n(),e.file_picker.files=[...t.dataTransfer.files].reduce(((e,t)=>(e.items.add(t),e)),new DataTransfer).files,s(t.dataTransfer)}))("drop")}(e.original_canvas),e.file_picker.addEventListener("change",(e=>{s(e.target)}));function d({r:e,g:t,b:a}){if(e<0||e>255||t<0||t>255||a<0||a>255)throw Error("RGB values must fall between 0 and 255");return"#"+[e,t,a].map((e=>{const t=e.toString(16);return 1===t.length?"0"+t:t})).join("").toUpperCase()}e.save_swatches.onclick=function(){let e=(e=>{let t=[],a=0,n=0;return e.sort().forEach(((e,i,l)=>{e=e.startsWith("#")?e:"#"+e,10==n&&(a++,n=0,t.push(`\n\x3c!--row_${a+1}--\x3e`));const o=50*n,c=50*a;t.push(`<path fill="${e}" d="M${o} ${c}h50v50H${o}z"/>`),n++})),'<svg xmlns="http://www.w3.org/2000/svg"><g>'+t.join("\n")+"\n</g></svg>"})(n.map(d));u({name:r.name+` (${n.length} chips)`,ext:"svg",fileData:e})};const u=({name:e,ext:t,fileData:a})=>{var n={svg:"image/svg+xml;charset=utf-8",txt:"text/plain;charset=utf-8"}[t],i=document.createElement("a");i.download=`${e}.${t}`,i.href=window.URL.createObjectURL(new Blob([a.trim()],{type:n})),i.onclick=e=>{document.body.removeChild(e.target)},i.style.display="none",document.body.appendChild(i),i.click()};function h(){if(!r)return;let t=e.original_canvas.parentElement,a=t.clientWidth,n=t.clientHeight,i=Math.min(a,n*r.aspect_ratio),l=Math.min(n,a/r.aspect_ratio);e.original_canvas.style.width=i+"px",e.original_canvas.style.height=l+"px",e.output_canvas.style.width=i+"px",e.output_canvas.style.height=l+"px"}function g(){l&&o?t.putImageData(e.toggle_greyscale.checked?l:o,0,0):console.log("Load an image to toggle greyscale")}function f(e){e.classList.add("hide")}function p(e){e.classList.remove("hide")}function v(){i=null,[...e.swatches_holder.children].forEach((e=>{e.classList.remove("active")})),f(c)}function m(){e.swatches_holder.innerHTML="",f(e.swatches_holder),n.forEach(((t,a)=>{const n=document.createElement("div");n.className="swatch",n.style.background=`rgb(${t.r},${t.g},${t.b})`,n.onclick=()=>{i!==a?(v(),i=a,n.classList.add("active"),p(c)):v()},e.swatches_holder.appendChild(n)})),n.length>0&&p(e.swatches_holder)}function _(){if(!n.length)return;let i=t.getImageData(0,0,e.original_canvas.width,e.original_canvas.height);for(let e=0;e<i.data.length;e+=4){let t=[i.data[e],i.data[e+1],i.data[e+2]],a=n.reduce(((e,a)=>y(t,w(e))<y(t,w(a))?e:a)),[l,o,c]=w(a);i.data[e]=l,i.data[e+1]=o,i.data[e+2]=c}a.putImageData(i,0,0)}function w({r:e,g:t,b:a}){return[e,t,a]}function y([e,t,a],[n,i,l]){return Math.sqrt((e-n)**2+(t-i)**2+(a-l)**2)}!function(){let a,n,i,l,o,c;t.canvas.addEventListener("mouseover",(l=>{a=t.canvas.getBoundingClientRect(),n=t.canvas.width/a.width,i=t.canvas.height/a.height,e.loupe.classList.remove("hide")})),t.canvas.addEventListener("mousemove",(r=>{l=Math.floor((r.clientX-a.left)*n),o=Math.floor((r.clientY-a.top)*i),c=t.getImageData(l,o,1,1).data,e.loupe.style.borderColor=`rgb(${c[0]},${c[1]},${c[2]})`,e.loupe.style.left=r.clientX+"px",e.loupe.style.top=r.clientY+"px",e.loupe.color={r:c[0],g:c[1],b:c[2]}})),t.canvas.addEventListener("mouseleave",(()=>{e.loupe.classList.add("hide")}))}(),c.onclick=function(e){e.stopPropagation(),n.splice(i,1),m(),_(),v()};</script></body></html>